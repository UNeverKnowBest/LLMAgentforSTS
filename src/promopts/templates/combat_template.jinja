{%- macro combat_template() -%}
## [COMBAT ANALYSIS - Turn {{ game_state.combat_state.turn }}]
**Core Philosophy:** Health is a resource. Perfect information enables perfect decisions. Every action should maximize expected value.

**Potential Combos & High-Damage Plays:**
{% set current_archetypes = archetypes[game_state.class] %}
{% for build in current_archetypes %}
    {% set build_cards_in_deck = [] %}
    {% for card in player_deck %}{% if card.id in build.key_cards or card.id in build.payoff_cards %}{{ build_cards_in_deck.append(card.id) }}{% endif %}{% endfor %}
    {% if build_cards_in_deck | length > 2 %}
- **{{ build.name }} Combo Detected:**
    {% if build.name == "Poison Build" %}**TACTICAL EXECUTION:** "If I apply 8 poison now, the enemy takes 8 damage this turn and 8 more next turn (16 total). If I use Catalyst next turn to triple it, that becomes 24 damage next turn. Compare this to playing a 12-damage attack card twice (24 total). The poison path is equivalent but leaves me energy for defense."
    {% elif build.name == "Strength Build" %}**TACTICAL EXECUTION:** "If I play Inflame (+2 Strength) now, every attack this turn and future turns deals +2 more damage. If I have 3 attacks in hand, that's +6 damage immediately, and exponentially more over time. This is better than a single big attack unless I need immediate lethal."
    {% elif build.name == "Barricade/Block Build" %}**TACTICAL EXECUTION:** "If I play Barricade, my 12 block becomes permanent. If I can generate 20+ block per turn after this, I become nearly invincible. The investment turn is worth the long-term safety."
    {% elif build.name == "Shiv Build" %}**TACTICAL EXECUTION:** "Each Shiv triggers my artifacts. If I generate 4 Shivs, that's +4 to all Shuriken/Kunai counters. The value compounds: small immediate damage, but massive scaling benefits."
    {% endif %}
    {% endif %}
{% endfor %}

**Player State:**
- **HP:** {{ game_state.combat_state.player.current_hp }} / {{ game_state.combat_state.player.max_hp }}
- **Block:** {{ game_state.combat_state.player.block }}
- **Energy:** {{ game_state.combat_state.player.energy }} / {{ game_state.max_hp }}
- **Hand ({{ game_state.combat_state.hand | length }} cards):**
  {% for card in game_state.combat_state.hand %}
  - **{{ card.name }}** ({{ card.cost }} E) | ID: {{ card.id }} | Playable: {{ card.is_playable }}{% if card.has_target %} [TARGETED]{% endif %}{% if card.upgrades > 0 %} (+{{ card.upgrades }}){% endif %}
    *{{ card.description }}*
  {% endfor %}

**Enemy State & Intent Analysis:**
{% for enemy in game_state.combat_state.monsters %}
- **{{ enemy.name }}** ({{ enemy.current_hp }}/{{ enemy.max_hp }} HP)
  **Intent:** {{ enemy.intent }}
  **Threat Assessment:** [Analyze immediate danger and action priority]
{% endfor %}

## **ADVANCED TACTICAL DECISION FRAMEWORK:**

**Turn Planning Matrix:**
```
Current Turn Analysis:
├── Lethal Check: "Can I deal {{ total_enemy_hp }} damage with my {{ game_state.combat_state.player.energy }} energy?"
├── Survival Check: "Enemy deals {{ total_incoming_damage }} damage. I have {{ game_state.combat_state.player.block }} block + {{ max_possible_block }} potential block."
├── Setup Analysis: "If I set up combo pieces this turn, what's my killing potential next turn?"
└── Resource Management: "What's the energy/card efficiency of each possible play sequence?"
```

**Multi-Turn Scenario Planning:**
1. **Immediate Lethal Path:**
   - "If I play [card sequence], I deal [X] damage for [Y] energy."
   - "Enemy dies this turn = combat ends, all future threats irrelevant."
   - "This path succeeds if [conditions]. Risk: [failure consequences]."

2. **Defensive Survival Path:**
   - "If I block for [X], I take [Y] damage, leaving me at [Z] HP."
   - "This keeps me alive, but next turn I face [next enemy intent]."
   - "Can I handle the next turn threat with my remaining cards/energy?"

3. **Setup/Scaling Path:**
   - "If I play setup cards this turn, next turn I can [enhanced capability]."
   - "This delays immediate value for exponential future value."
   - "Comparison: Setup path total value over 2 turns vs. aggressive path value."

**Energy Efficiency Calculations:**
- **For each possible card combination:**
  - "Option A: [Cards] for [Energy] = [Damage/Block ratio]"
  - "Option B: [Different cards] for [Same energy] = [Different ratio]"
  - "Option A is superior because [mathematical reasoning]."

**Risk-Adjusted Decision Making:**
- **High-certainty plays:** "This guarantees [outcome] with [probability]."
- **High-variance plays:** "This could result in [best case] but risks [worst case]."
- **Context consideration:** "Given my current HP/deck state, [safer/riskier] approach is optimal because [contextual reasoning]."

**Final Decision Template:**
"I will play [specific card sequence] because:
- **Immediate effect:** [What happens this turn]
- **Strategic value:** [How this advances my win condition]  
- **Alternative rejected:** [Other option] because [specific inferior aspect]
- **Risk mitigation:** [How I'm handling potential downsides]"

## **EXECUTION COMMANDS:**
- `play X` (for non-targeted cards, where X is 1-10)
- `play X Y` (for targeted cards, where X is card index 1-10, Y is monster index 0-2)
- `end` (to finish turn)
- `potion use X` or `potion discard X` (where X is potion slot 0-4)
- `potion use X Y` (for targeted potions, Y is monster index 0-2)
{%- endmacro -%}

{# card_reward_template.jinja #}
{%- macro card_reward_template() -%}