## [GRID SELECTION]
**Objective:** {{ screen_state.prompt }}
**Analysis:** You must select a card from a grid. The optimal choice depends entirely on the reason for the selection.

{% set prompt_text = screen_state.prompt | lower %}

{# --- SCENARIO 1: UPGRADING a card (e.g., at a Rest Site, from an Event) --- #}
{% if "upgrade" in prompt_text %}
**Strategic Goal:** Upgrade the card that provides the greatest increase in power for your deck.
**Upgrade Priority List:**
1.  **Archetype Payoffs:** Upgrade cards that are central to your win condition (e.g., `Catalyst` to triple poison, `Body Slam` to gain damage).
2.  **Cost Reduction:** Upgrade cards whose energy cost is reduced (e.g., `Corruption`, `Eruption`). This is a massive power boost.
3.  **Functionality Change:** Upgrade cards whose core function improves dramatically (e.g., `Bash` applies more Vulnerable, `Noxious Fumes` becomes innate).
4.  **Most Played Cards:** If none of the above apply, upgrade a powerful Attack or Skill card that you play frequently.
*(Note: Almost never upgrade a basic Strike or Defend unless forced to.)*

{# --- SCENARIO 2: REMOVING a card (e.g., at a Shop, from an Event) --- #}
{% elif "remove" in prompt_text %}
**Strategic Goal:** Improve deck consistency by removing the weakest, most situational, or most harmful card.
**Removal Priority List:**
1.  **Curses:** Always remove any Curse cards first. They provide no benefit and are purely negative.
2.  **Basic Strikes:** Your starting Strikes are the weakest damage cards. Removing them makes you more likely to draw your better attacks.
3.  **Basic Defends:** After removing Strikes, starting Defends are the next priority to improve deck quality.
4.  **Non-Synergistic Cards:** Remove cards that do not fit your established deck archetype.

{# --- SCENARIO 3: RETRIEVING a card (e.g., Headbutt, Hologram) --- #}
{% elif "add to your hand" in prompt_text or "put into your hand" in prompt_text %}
**Strategic Goal:** Choose a card from the discard/draw pile that provides the most immediate tactical advantage.
**Retrieval Priority List:**
1.  **Immediate Lethal/Survival:** Can a specific card win the fight *this turn* or prevent lethal damage? (e.g., grabbing a `Body Slam` with high block, or a key defensive card).
2.  **Combo Execution:** Select a card that completes a powerful combo (e.g., retrieving `Catalyst` to use again, grabbing `Limit Break` after playing `Inflame`).
3.  **Archetype Engine:** Select a card that powers your deck's main strategy (e.g., a card that draws more cards, a key Power).
4.  **Best General Value:** If none of the above, pick the strongest standalone card available.

{# --- DEFAULT SCENARIO --- #}
{% else %}
**Strategic Goal:** Follow the prompt's instructions and choose the card that best fits your overall strategy.
{% endif %}

**Card Choices (from Grid):**
{% for card in screen_state.cards %}
- **[Option {{ loop.index0 }}] {{ card.name }}**{% if card.upgrades > 0 %} (+{{ card.upgrades }}){% endif %}
  *{{ card.description }}*
{% endfor %}

**Instructions:**
1.  Identify the scenario (Upgrade, Remove, Retrieve, etc.) from the prompt.
2.  Follow the prioritized list for that scenario to determine the best card.
3.  Formulate the command: `choose X` (where X is card index 0-based).
